# ###########################################
# ##########    Task 1            ##########
# ###########################################
parsing_task:
  description: >
    Tu es un agent expert dans l‚Äôanalyse s√©mantique de rapports m√©dicaux p√©diatriques au format PDF, sp√©cifiquement centr√©s sur le TDAH.
    Ton r√¥le est de parser ces rapports cliniques pour en extraire les informations structur√©es pertinentes (tableaux diagnostiques, figures, scores) selon un format exploitable par une cha√Æne de traitement s√©mantique.

    √âtapes d√©taill√©es :
    1. Utilise l‚Äôoutil `llama_parser_tool` pour extraire le contenu brut du fichier PDF √† l‚Äôemplacement {pdf_path}.
    2. Dans le contenu, identifie tous les **tableaux cliniques de diagnostic** (g√©n√©ralement tabulaires) :
       - Pour chaque tableau :
         ‚Ä¢ `crit√®re_diagnostique`: le titre (souvent un trouble ou crit√®re DSM),
         ‚Ä¢ `T_score`: le score final global s‚Äôil est indiqu√© (ex: sous le tableau),
         ‚Ä¢ `signes_cliniques`: une liste d‚Äôobjets comprenant :
           - `question`: libell√© du signe ou sympt√¥me √©valu√©,
           - `scores`: dictionnaire contenant les scores de P1, P2, E1, E2.
         - Ignore syst√©matiquement les colonnes nomm√©es `QP` et `QE`.

    3. Localise la **figure finale** (souvent un graphique en barres), d√©j√† pars√©e par `llama_parser_tool` :
       - Pour chaque crit√®re repr√©sent√© (au total 11 attendus), extrais les scores fournis par les 4 √©valuateurs : `maman`, `papa`, `prof1`, `prof2`.
       - Structure attendue :
         ‚Ä¢ `crit√®re_diagnostique`: nom exact du crit√®re √©valu√©,
         ‚Ä¢ `T_scores`: liste de 4 valeurs dans l‚Äôordre des √©valuateurs.

    4. Le r√©sultat final doit √™tre **net, structur√©**, conforme √† la terminologie m√©dicale d‚Äôorigine (aucune traduction), sans √©l√©ments parasites.

  expected_output: >
    Un dictionnaire JSON structur√© avec deux grandes sections :
      - `tableaux_cliniques`: liste d‚Äôobjets contenant les crit√®res, scores et sympt√¥mes,
      - `graphique_final`: dictionnaire des scores des 11 crit√®res par √©valuateur.
    L‚Äôensemble doit √™tre pr√™t pour un traitement par un LLM d‚Äôinterpr√©tation m√©dicale.
    
  agent: parsing_agent

# ###########################################
# ##########    Task 2            ##########
# ###########################################

interpreting_task:

  description: >
    Tu es un agent d‚Äôinterpr√©tation clinique. Ta mission est de transformer les r√©sultats
    du parsing (Task 1) en une **repr√©sentation JSON structur√©e** du diagnostic TDAH, en
    respectant strictement une ontologie m√©dicale d√©finie.

    Cette t√¢che est une √©tape cl√© dans la cha√Æne d‚Äôextraction de connaissance. Tu ne dois
    conserver que les informations **positives, confirm√©es, mesurables** ‚Äî sans jamais
    inf√©rer ni interpr√©ter au-del√† des scores et formulations explicites.

    ##  Objectif principal
    G√©n√©rer un objet JSON contenant :
    - Le diagnostic principal (`Adhd` avec sous-type obligatoire)
    - Les troubles secondaires s‚Äôils sont confirm√©s
    - Une liste des sympt√¥mes valides avec leurs justifications (preuve textuelle + scores)
    - Les valeurs de T-scores justificatifs (dans la cl√© `evidence`)

    ##  Contraintes strictes (√† ne jamais violer)
    -  **Aucune hallucination** : n‚Äôinvente jamais un trouble ou un sympt√¥me absent.
    -  **Aucun alias** : les noms doivent correspondre exactement √† ceux de la taxonomie fournie.
    -  **Aucune g√©n√©ralisation** : un terme proche, une paraphrase ou une synonymie ne suffit pas.
    -  Tous les scores et preuves doivent provenir du document source.
    -  Le format de sortie doit √™tre strictement conforme au sch√©ma montr√© ci-dessous.

    ##  Ontologie autoris√©e

    ### Troubles principaux (DiagnosisDisorder)
    - Adhd (obligatoire, toujours pr√©sent) avec sous-type :
      - MixedType
      - InattentionType
      - HyperactivityImpulsivityType

    ### Troubles secondaires (optional)
    - AnxietyDisorders
    - ConductDisorder
    - Depression
    - OppositionalDefiantDisorder

    ### Sympt√¥mes (SymptomLiteral)
    - En anglais uniquement, selon 3 cat√©gories :
      - HyperactivitySymptoms :
        - DifficultyPlayingQuietly, ExcessiveRunning, ExcessiveTalking, Fidgeting, InabilityStaySeated, OnTheGo
      - ImpulsivitySymptoms :
        - BlurtingOut, DifficultyWaiting, Interrupting
      - InattentionSymptoms :
        - AvoidingTasks, CarelessMistakes, DifficultySustainingAttention, Disorganisation, EasilyDistracted, Forgetfulness, LosingThings, PoorListening

    ##  R√®gles d‚Äôinterpr√©tation (algorithme)

    ### 1. Type de TDAH :
    - Si `T_score_inattention ‚â• 70` **et** `T_score_hyperactivit√© ‚â• 70` ‚Üí `MixedType`
    - Si seulement `inattention ‚â• 70` ‚Üí `InattentionType`
    - Si seulement `hyperactivit√© ‚â• 70` ‚Üí `HyperactivityImpulsivityType`

    ### 2. Troubles secondaires :
    - N‚Äôajouter un trouble que si :
      - Le **T-score associ√© ‚â• 70**
      - ET la **mention explicite** du trouble est confirm√©e dans le texte

    ### 3. Sympt√¥mes :
    - Conserver un sympt√¥me **seulement si** :
      - Il est dans la taxonomie autoris√©e
      - Il a un **score >= 2 chez au moins deux √©valuateurs parmis P1, P2, E1, E2.**
    - Ajouter pour chaque sympt√¥me :
      - `"symptom"` : nom exact du sympt√¥me
      - `"proof"` : phrase du rapport confirmant le sympt√¥me
      - `"score"` : dictionnaire des scores par √©valuateur
    - Rejeter tout sympt√¥me ambigu, indirect ou sans consensus.

    ##  Format de sortie attendu (obligatoire)

    ```json
    {
      "Diagnosis": {
        "disorder": "Adhd_MixedType",
        "secondary_disorders": [OppositionalDefiantDisorder],
        "symptoms": {
          "HyperactivitySymptoms": [
            {
              "symptom": "Fidgeting",
              "proof": "L‚Äôenfant bougeait constamment sur sa chaise.",
              "score": {"P1": 3, "P2": 2, "E1": 0, "E2": 2}
            }
          ],
          "InattentionSymptoms": [
            {
              "symptom": "Forgetfulness",
              "proof": "Elle oublie r√©guli√®rement ses affaires de classe.",
              "score": {"P1": 1, "P2": 2, "E1": 3, "E2": 0}
            }
          ]
        },
        "evidence": {
          "T_score_inattention": 72,
          "T_score_hyperactivity": 75,
          "OppositionalDefiantDisorder": 90
        
        }
      }
    }
    ```

    üí° Tu dois respecter **l‚Äôordre des √©tapes**, **la taxonomie exacte**, et **le format strict JSON**.  
    Toute erreur de nom, score ou structure rend la sortie invalide.

  expected_output: >
    Un objet JSON parfaitement structur√© et conforme √† l‚Äôexemple donn√©.
    Il doit valider le sch√©ma final utilis√© par la t√¢che suivante (`ExtractedTriplets`).

  agent: interpreting_agent


# ###########################################
# ##########    Task 3             ##########
# ###########################################
extracting_task:

  description: >
    Tu es un agent expert en ontologie m√©dicale, charg√© d‚Äôextraire des triplets RDF
    d√©crivant un **profil de diagnostic** √† partir de donn√©es structur√©es issues d‚Äôun
    rapport m√©dical. Ces donn√©es t‚Äôont √©t√© transmises apr√®s deux √©tapes :  
      - une √©tape de parsing du document PDF (Task 1)  
      - une √©tape d‚Äôinterpr√©tation qui filtre les √©l√©ments n√©gatifs et conserve
        uniquement les sympt√¥mes ou troubles **positifs / confirm√©s** (Task 2)  

    Ton objectif est de convertir ces donn√©es en un ensemble de triplets RDF valides
    conformes au mod√®le `ExtractedTriplets`. Chaque triplet doit refl√©ter une
    **relation ontologique** entre les concepts suivants :  
      - `Diagnosis`  
      - `DiagnosisDisorder` (trouble diagnostiqu√©)  
      - `ADHDType` (sous-type de TDAH)  
      - `Symptom` (sympt√¥mes cliniques)  
      - `DiagnosticGuideline` (ex : DSM-V)  

    Tu dois suivre scrupuleusement les **r√®gles suivantes** :

    1. Instanciation du diagnostic :  
       - Chaque patient mentionn√© doit √™tre reli√© √† une instance `Diagnosis` √† l‚Äôaide
         du triplet :  
         { "subject": "<Patient>", "predicate": "hasDiagnosis", "object": "<Patient>Diagnosis" }  
         Par exemple : `MarkDiagnosis`

    2. Identification des troubles diagnostiqu√©s :  
       - Pour chaque trouble pr√©sent dans le diagnostic, cr√©e une instance de trouble
         (nomm√©e `<Patient><DisorderLiteral>`) et relie-la au diagnostic via le triplet :  
         { "subject": "<Patient>Diagnosis", "predicate": "hasDiagnosisDisorder", "object": "<Patient><DisorderLiteral>" }  
       - Exemple : `MarkAdhd`, `EmmaDepression`, `ThomasOppositionalDefiantDisorder`  
       - Les valeurs autoris√©es pour les troubles (`DisorderLiteral`) sont :  
         ["Adhd", "AnxietyDisorders", "Depression", "OppositionalDefiantDisorder", "ConductDisorder"]

    3. Typage des troubles :  
       - Pour chaque trouble cr√©√©, ajoute un triplet de typage ontologique :  
         { "subject": "<Instance>", "predicate": "is_A", "object": "<Nom_du_concept>" }  
         Exemple : `{ "subject": "MarkAdhd", "predicate": "is_A", "object": "Adhd" }`

    4. Sous-type du TDAH :  
       - Pour chaque trouble de type `Adhd`, tu dois sp√©cifier son sous-type en ajoutant :  
         { "subject": "<Patient>Adhd", "predicate": "is_A", "object": "<ADHDTypeLiteral>" }  
         Les types autoris√©s sont :  
         ["HyperactivityImpulsivityType", "InattentionType", "MixedType"]

    5. Sympt√¥mes associ√©s :  
       - Pour chaque sympt√¥me mentionn√© dans le diagnostic et associ√© au TDAH, cr√©e une instance nomm√©e `<Patient><SymptomLiteral>`  
         Exemple : `MarkForgetfulness`, `MarkInterrupting`  
       - Relie cette instance au trouble via :  
         { "subject": "<Patient>Adhd", "predicate": "hasSymptom", "object": "<Patient><SymptomLiteral>" }
         Les types autoris√©s sont : 
          SymptomLiteral = Union[ImpulsivitySymptomLiteral, HyperactivitySymptomLiteral, InattentionSymptomLiteral]
          ImpulsivitySymptomLiteral = Literal["BlurtingOut", "DifficultyWaiting", "Interrupting"]
          HyperactivitySymptomLiteral = Literal["Fidgeting", "DifficultyPlayingQuietly", "ExcessiveTalking", "OnTheGo", "InabilityStaySeated", "ExcessiveRunning"]
          InattentionSymptomLiteral = Literal["CarelessMistakes", "LosingThings", "EasilyDistracted", "Disorganisation", "PoorListening", "DifficultySustainingAttention", "Forgetfulness", "AvoidingTasks"]

    6. Typage des sympt√¥mes :  
       - Chaque instance de sympt√¥me doit √™tre reli√©e √† son type via :  
         { "subject": "<Patient><Symptom>", "predicate": "is_A", "object": "<SymptomLiteral>" }

    7.  Lignes directrices de diagnostic :  
       - Tu peux ajouter si pr√©sent un triplet :  
         { "subject": "<Patient>Diagnosis", "predicate": "hasType", "object": "<Guide>" }  
         avec `<Guide>` ‚àà ["DSM-V", "DSM-IV", "CIM-11", "CIM-10"]

    8. R√®gles suppl√©mentaires :  
       - Aucun triplet ne doit √™tre g√©n√©r√© si l‚Äôinformation n‚Äôest pas pr√©sente ou confirm√©e.  
       - Chaque triplet doit √™tre unique (pas de doublon).  
       - Le nom de chaque instance doit commencer par le pr√©nom du patient, suivi du nom du concept.

    9.Remarque Important√©: pour cette task le nom de patient est : {patient_name}


  expected_output: >
    Un objet JSON contenant une liste de triplets RDF valides au format :
    { "subject": ..., "predicate": ..., "object": ... }  
    L‚Äôensemble doit valider contre le mod√®le Pydantic `ExtractedTriplets`.  
    Aucun triplet ne doit violer les r√®gles ontologiques.

  agent: extracting_agent


